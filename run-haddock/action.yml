name: 'Generate haddock documentation'
description: 'Generate haddock documentation and check if there is documentation missing'
outputs:
  haddock-path:
    description: the path where the Haddock documentation generated by this composite resides
    value: ${{ steps.haddock-path.outputs.haddock-path  }}
runs:
  using: "composite"
  steps:
    - name: build the Haddock documentation
      run: stack haddock --force-dirty
      shell: bash
    - name: Check for missing documentation
      run: "! stack haddock --force-dirty 2>&1 | grep -P '^\\s*[0-9]{1,2}%'"
      shell: bash
    - name: Determine the haddock path
      id: haddock-path
      run: echo "::set-output name=haddock-path::$(stack path --local-doc-root)"
      shell: bash

